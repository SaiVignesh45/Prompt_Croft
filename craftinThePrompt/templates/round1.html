<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Round 1 | AI Challenge</title>
</head>
<body class="bg-gray-950 text-white font-mono flex h-screen overflow-hidden">
    <div class="w-72 bg-gray-900 border-r border-gray-800 flex flex-col">
        <div class="p-6 border-b border-gray-800">
            <h2 class="text-xl font-bold text-green-400 tracking-tighter">{{ session.team | upper }}</h2>
            <div id="timer" class="text-yellow-500 font-bold mt-2">00:00:00</div>
        </div>
        <div class="flex-1 overflow-y-auto p-4 space-y-3">
            {% for lvl in levels %}
            <a href="{{ url_for('round1', lvl=lvl.id) }}" 
               class="block p-4 rounded border {{ 'bg-green-900/40 border-green-500' if lvl.id in solved else 'bg-gray-800 border-gray-700 hover:border-blue-500' }}">
                <div class="text-sm font-bold">{{ lvl.title }}</div>
                <div class="text-xs {{ 'text-green-300' if lvl.id in solved else 'text-gray-500' }}">
                    {{ "COMPLETED" if lvl.id in solved else "IN PROGRESS" }}
                </div>
            </a>
            {% endfor %}
        </div>
        <div class="p-4 border-t border-gray-800">
            <a href="{{ url_for('round2') }}" class="block text-center bg-blue-600 hover:bg-blue-500 p-3 rounded font-bold">Go to Round 2</a>
        </div>
    </div>

    <div class="flex-1 flex flex-col bg-black">
        <div class="p-8 max-w-4xl w-full mx-auto">
            <h2 class="text-2xl font-bold text-white mb-2">{{ levels[current].title }}</h2>
            <p class="text-gray-400 mb-8">{{ levels[current].desc }}</p>

            <form method="POST" class="space-y-4">
                <input type="hidden" name="lvl_idx" value="{{ current }}">
                <textarea name="user_input" required rows="5" class="w-full bg-gray-900 border border-gray-700 p-4 rounded focus:border-green-500 outline-none" placeholder="Enter your prompt injection attack..."></textarea>
                <div class="flex justify-end">
                    <button class="bg-red-600 hover:bg-red-500 px-8 py-3 rounded font-bold uppercase tracking-widest">Execute Attack</button>
                </div>
            </form>

            {% if last_resp %}
            <div class="mt-8">
                <div class="text-xs text-gray-500 mb-2 uppercase tracking-widest">AI Result</div>
                <div class="bg-gray-900 border-l-4 border-blue-500 p-6 rounded text-gray-200">
                    {{ last_resp }}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        let startTime = {{ session.start_time }};
        setInterval(() => {
            let diff = Math.floor(Date.now() / 1000) - startTime;
            let h = Math.floor(diff / 3600).toString().padStart(2, '0');
            let m = Math.floor((diff % 3600) / 60).toString().padStart(2, '0');
            let s = (diff % 60).toString().padStart(2, '0');
            document.getElementById('timer').innerText = `${h}:${m}:${s}`;
        }, 1000);
    </script>
</body>
</html>